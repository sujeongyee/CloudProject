<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.server.cloud.engineer.service.EngineerMapper">

	<select id="newList" resultType="EngSerProInfoWorkInfoVO">
	
		SELECT DISTINCT
		C.CUS_ADDRESS1,
        C.CUS_ADDRESS2,
        C.CUS_BOSS,
        C.CUS_BUSINESS_ID,
        C.CUS_COMPANY_NAME,
        C.CUS_EMAIL,
        C.CUS_COMPANY_PH,
        C.CUS_ID,
        C.CUS_MANAGET_NAME,
        C.CUS_NUM,
        C.CUS_PHONE_NUMBER,
        P.PRO_ENDDATE,
        P.PRO_ID,
        P.PRO_INFO,
        P.PRO_NAME,
        P.PRO_PI,
        P.PRO_REP,
        P.PRO_STARTDATE,
        P.PRO_STATUS
        FROM ENGINEER E
		LEFT JOIN SERVER S ON E.ENG_ENID = S.ENG_ENID
		LEFT JOIN PROJECTINFO P ON S.PRO_ID = P.PRO_ID
        LEFT JOIN CUSTOMER C ON P.CUS_ID = C.CUS_ID
		LEFT JOIN WORKINFO W ON W.ENG_ENID
		= E.ENG_ENID
		WHERE E.ENG_ENID = #{eng_enid};
		
	</select>




	<select id="engProInfo" resultType="EngSerProInfoWorkInfoVO">
		SELECT DISTINCT
		E.ENG_ENID,
		E.ENG_NAME,
		P.PRO_NAME,
		P.PRO_ID
		FROM ENGINEER E
		LEFT JOIN SERVER S ON E.ENG_ENID = S.ENG_ENID
		LEFT JOIN
		PROJECTINFO P ON S.PRO_ID = P.PRO_ID
		LEFT JOIN WORKINFO W ON W.ENG_ENID
		= E.ENG_ENID
		WHERE E.ENG_ENID = #{ENG_ENID};
	</select>

	<select id="serverList" resultType="ServerVO">
		SELECT * FROM SERVER;
	</select>

	<insert id="registWorkLog" parameterType="java.util.List">
		insert into WORKINFO
		(work_date,
		work_division,
		work_time,
		work_cpu,
		work_ram,
		work_hdd,
		work_note,
		work_estimate,
		work_status,
		server_id,
		eng_enid,
		pro_id)
		values
		<foreach collection="list" item="workInfo" separator=",">
			(#{workInfo.work_date},
			#{workInfo.work_division},
			#{workInfo.work_time},
			#{workInfo.work_cpu},
			#{workInfo.work_ram},
			#{workInfo.work_hdd},
			#{workInfo.work_note},
			#{workInfo.work_estimate},
			#{workInfo.work_status},
			#{workInfo.server_id},
			#{workInfo.eng_enid},
			#{workInfo.pro_id}
			)
		</foreach>
	</insert>

	<select id="engineerList"
		resultType="com.server.cloud.command.EngineerVO">
		select e.*, t.team_id
		from ENGINEER e
		inner join ENG_TEAM t on e.team_num = t.team_num
		where e.team_num='8fcc9b5c-4bd8-11ee-8c2a-0ef820116d74';
		
		<!-- where e.team_num=#{team_num}; -->
	</select> 


	<select id="inspectionList"
		resultType="com.server.cloud.command.WorkInfoVO">
 		select wi.*, si.server_name, ei.eng_name, ei.eng_num, si.server_status, pi.pro_name
		from WORKINFO wi
		join SERVER si on wi.server_id = si.server_id
		join ENGINEER ei on wi.eng_enid = ei.eng_enid
		join PROJECTINFO pi on wi.pro_id = pi.pro_id
		where ei.eng_num='3a4d1177-578f-11ee-b0dd-0a2a1041ddde';
		<!-- where ei.eng_num ={eng_num}; -->

	</select>

	<select id="serverDetailModal">
		select s.*, p.pro_name
		from SERVER s
		inner join PROJECTINFO p on s.pro_id = p.pro_id
		where server_id=#{server_id};
	</select>

 	<select id="pastInspectionHistoryList">
<!-- 		select wi.*, s.server_name, s.server_id
		from workinfo wi
		inner join server s on wi.server_id = s.server_id
		where server_id=#{server_id}; -->
		select wi.*, s.server_name
		from WORKINFO wi
		inner join SERVER s on wi.server_id = s.server_id
		where wi.server_id=#{server_id};
	</select> 

	<select id="getProjectDetail">
  		SELECT * FROM CUSTOMER C
		LEFT JOIN PROJECTINFO P
		ON C.CUS_ID = P.CUS_ID
		WHERE P.PRO_ID=#{pro_id}
  	</select>
	
	<select id="getProjectServer">
  		SELECT S.*,E.ENG_NAME 
  		FROM SERVER S 
  		LEFT JOIN ENGINEER E 
  		ON S.ENG_ENID = E.ENG_ENID 
  		WHERE S.PRO_ID=#{pro_id}
  	</select>
  	
  	<update id="editSchedule">
  		UPDATE ENG_SCHEDULE SET
  		SCHE_STARTDATE = #{sche_startdate},
  		SCHE_ENDDATE = #{sche_enddate}
  		WHERE SCHE_NUM = #{sche_num}
  	</update>
  	
  	<update id="updateWorkStatus">
  		UPDATE WORKINFO SET WORK_STATUS = #{work_status} WHERE SERVER_ID = #{server_id};
  	</update>

</mapper>